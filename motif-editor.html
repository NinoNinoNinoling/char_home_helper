<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëª¨í‹°í”„ í¸ì§‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="utils.js"></script>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-100">

    <nav class="bg-white border-b px-6 py-3 flex justify-between items-center z-10 shrink-0 shadow-sm">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-indigo-600"><i data-lucide="arrow-left"></i></a>
            <h1 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="sparkles" class="text-orange-600"></i> ëª¨í‹°í”„ í¸ì§‘ê¸°
            </h1>
        </div>
        <button onclick="exportData()" class="btn btn-success">
            <i data-lucide="save" class="w-4 h-4"></i> ì½”ë“œ ìƒì„±
        </button>
    </nav>

    <div class="bg-white border-b p-4 shrink-0">
        <label class="form-label">ğŸ“‚ motif.js ì½”ë“œ ë¶™ì—¬ë„£ê¸°</label>
        <div class="flex gap-2 relative">
            <textarea id="inputCode" rows="1" class="form-input flex-1 h-10 resize-none" 
                placeholder="export const motifData = [...]"></textarea>
            <button onclick="loadData()" class="btn btn-secondary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <div id="inputBlocker" class="absolute inset-0 bg-gray-100/80 hidden flex items-center justify-center text-xs font-bold text-gray-500">ë¡œë“œë¨</div>
        </div>
    </div>

    <div class="flex-1 overflow-hidden grid grid-cols-12">
        <div class="col-span-3 bg-white border-r flex flex-col overflow-hidden">
            <div class="p-3 bg-slate-50 border-b flex justify-between items-center">
                <span class="font-bold text-sm text-slate-700">ëª¨í‹°í”„ (<span id="itemCount">0</span>)</span>
                <button onclick="addItem()" class="text-xs bg-indigo-500 text-white px-2 py-1 rounded">+ ì¶”ê°€</button>
            </div>
            <div id="itemList" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-50">
                <div class="text-center text-gray-400 text-xs mt-10">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <div class="col-span-9 bg-slate-50 overflow-y-auto p-6">
            <div id="editForm" class="hidden max-w-2xl mx-auto card">
                <div class="card-header flex justify-between items-center">
                    <h2 class="font-bold">ğŸ“ ëª¨í‹°í”„ í¸ì§‘</h2>
                    <span id="currentIdx" class="text-xs bg-slate-200 px-2 py-1 rounded">#-</span>
                </div>
                <div class="card-body space-y-4">
                    <div>
                        <label class="form-label">ì´ë¯¸ì§€ URL</label>
                        <input type="text" id="edit_image" class="form-input">
                        <div id="imagePreview" class="mt-2 hidden">
                            <img src="" alt="ë¯¸ë¦¬ë³´ê¸°" class="w-32 h-32 object-cover rounded border">
                        </div>
                    </div>
                    <div>
                        <label class="form-label">ì´ë¦„/ì œëª©</label>
                        <input type="text" id="edit_title" class="form-input">
                    </div>
                    <div>
                        <label class="form-label">ì¶œì²˜</label>
                        <input type="text" id="edit_source" class="form-input" placeholder="ì‘í’ˆëª…">
                    </div>
                    <div>
                        <label class="form-label">ì„¤ëª…</label>
                        <textarea id="edit_description" rows="4" class="form-input form-textarea"></textarea>
                    </div>
                    <div class="pt-4 border-t flex justify-between">
                        <button onclick="deleteItem()" class="btn btn-danger text-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> ì‚­ì œ
                        </button>
                        <div class="flex gap-2">
                            <button onclick="moveItem(-1)" class="btn btn-secondary text-sm">â†‘ ìœ„ë¡œ</button>
                            <button onclick="moveItem(1)" class="btn btn-secondary text-sm">â†“ ì•„ë˜ë¡œ</button>
                            <button onclick="saveItem()" class="btn btn-primary">ì ìš©</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="exportArea" class="hidden mt-6 code-output max-w-2xl mx-auto">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-green-400 font-bold">âœ… ì½”ë“œ ìƒì„± ì™„ë£Œ</span>
                    <button onclick="copyCode()" class="btn btn-success text-sm">ğŸ“‹ ë³µì‚¬</button>
                </div>
                <textarea id="exportResult" rows="15" class="w-full" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        let items = [];
        let currentIndex = -1;

        function loadData() {
            const raw = document.getElementById('inputCode').value.trim();
            if (!raw) return alert('ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.');
            try {
                items = HelperUtils.parseExportData(raw, 'motifData');
                renderList();
                document.getElementById('inputBlocker').classList.remove('hidden');
                HelperUtils.showToast(`${items.length}ê°œ ëª¨í‹°í”„ ë¡œë“œ!`, 'success');
            } catch (e) { alert('ë¡œë“œ ì‹¤íŒ¨: ' + e.message); }
        }

        function renderList() {
            document.getElementById('itemCount').textContent = items.length;
            if (items.length === 0) {
                document.getElementById('itemList').innerHTML = '<div class="text-center text-gray-400 text-xs mt-10">ëª¨í‹°í”„ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            document.getElementById('itemList').innerHTML = items.map((item, idx) => `
                <div class="list-item ${idx === currentIndex ? 'active' : ''}" onclick="openForm(${idx})">
                    <span class="truncate font-medium text-sm">${item.title || '(ì´ë¦„ ì—†ìŒ)'}</span>
                    <span class="text-xs text-slate-400">${item.source || ''}</span>
                </div>
            `).join('');
        }

        function openForm(idx) {
            currentIndex = idx;
            const item = items[idx];
            document.getElementById('editForm').classList.remove('hidden');
            document.getElementById('currentIdx').textContent = `#${idx + 1}`;
            document.getElementById('edit_image').value = item.image || '';
            document.getElementById('edit_title').value = item.title || '';
            document.getElementById('edit_source').value = item.source || '';
            document.getElementById('edit_description').value = item.description || '';
            updatePreview();
            document.getElementById('exportArea').classList.add('hidden');
            renderList();
        }

        function updatePreview() {
            const url = document.getElementById('edit_image').value;
            const preview = document.getElementById('imagePreview');
            if (url) {
                preview.querySelector('img').src = url;
                preview.classList.remove('hidden');
            } else {
                preview.classList.add('hidden');
            }
        }

        document.getElementById('edit_image').addEventListener('input', updatePreview);

        function addItem() {
            items.push({ image: '', title: 'ìƒˆ ëª¨í‹°í”„', source: '', description: '' });
            renderList();
            openForm(items.length - 1);
        }

        function saveItem() {
            if (currentIndex === -1) return;
            items[currentIndex] = {
                image: document.getElementById('edit_image').value,
                title: document.getElementById('edit_title').value,
                source: document.getElementById('edit_source').value,
                description: document.getElementById('edit_description').value
            };
            renderList();
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function deleteItem() {
            if (currentIndex === -1) return;
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            items.splice(currentIndex, 1);
            document.getElementById('editForm').classList.add('hidden');
            currentIndex = -1;
            renderList();
        }

        function moveItem(dir) {
            if (currentIndex === -1) return;
            const newIdx = currentIndex + dir;
            if (newIdx < 0 || newIdx >= items.length) return;
            [items[currentIndex], items[newIdx]] = [items[newIdx], items[currentIndex]];
            currentIndex = newIdx;
            renderList();
            HelperUtils.showToast('ì´ë™ë¨', 'success');
        }

        function exportData() {
            if (currentIndex !== -1) saveItem();
            const code = HelperUtils.generateMotifCode(items);
            document.getElementById('exportArea').classList.remove('hidden');
            document.getElementById('exportResult').value = code;
            document.getElementById('exportArea').scrollIntoView({ behavior: 'smooth' });
        }

        function copyCode() {
            HelperUtils.copyToClipboard(document.getElementById('exportResult').value);
            HelperUtils.showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
    </script>
</body>
</html>

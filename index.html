<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Playlist Data Maker v3.1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" />
    <style>
        body { font-family: "Pretendard Variable", sans-serif; background: #f3f4f6; padding: 20px; }
        textarea { font-family: monospace; font-size: 0.85rem; line-height: 1.5; }
    </style>
</head>
<body class="max-w-6xl mx-auto">

    <h1 class="text-3xl font-bold mb-6 text-gray-800 flex items-center gap-2">
        🎵 플레이리스트 데이터 생성기 <span class="text-sm bg-teal-100 text-teal-800 px-2 py-1 rounded">v3.1 (스마트 정렬)</span>
    </h1>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        
        <div class="bg-white p-6 rounded-lg shadow-md space-y-4">
            <h2 class="text-xl font-semibold border-b pb-2">1. 신규 곡 정보 입력</h2>
            
            <div>
                <label class="block text-sm font-medium text-gray-700">곡 제목 (Title)</label>
                <input type="text" id="newTitle" class="mt-1 block w-full p-2 border rounded-md" placeholder="예: 몽유병자는 차안에서">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">가수 (Artist)</label>
                <input type="text" id="newArtist" class="mt-1 block w-full p-2 border rounded-md" placeholder="예: 키타니 타츠야">
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">유튜브 링크 (Link)</label>
                <input type="text" id="newLink" class="mt-1 block w-full p-2 border rounded-md" placeholder="https://www.youtube.com/watch?v=...">
            </div>

            <div class="p-3 bg-purple-50 rounded border border-purple-200">
                <label class="block text-sm font-bold text-purple-800">번역 출처 (Source)</label>
                <input type="text" id="newSource" class="mt-1 block w-full p-2 border rounded-md text-sm" placeholder="예: http://vocaro.wikidot.com/...">
            </div>

            <div>
                <div class="flex flex-col gap-2 mb-2">
                    <label class="block text-sm font-medium text-gray-700">가사 (Lyrics)</label>
                    
                    <div class="p-2 bg-blue-50 border border-blue-200 rounded">
                        <span class="text-xs text-blue-800 font-bold block mb-1">🔽 줄바꿈 정리 모드 선택:</span>
                        <select id="lineOption" class="w-full text-sm border border-blue-300 rounded p-1">
                            <option value="0">사용 안 함 (그대로 복사)</option>
                            <optgroup label="패턴 정렬 (일/한 번역 가사용)">
                                <option value="1">1줄마다 띄기</option>
                                <option value="2">2줄마다 띄기</option>
                                <option value="3" selected>3줄마다 띄기 (추천)</option>
                            </optgroup>
                            <optgroup label="구조 유지 (복합/영어 가사용)">
                                <option value="4">✨ 과한 엔터 정리 (최대 1줄 빈칸 유지)</option>
                                <option value="5">🔥 모든 빈 줄 제거 (빈칸 없이 붙이기)</option>
                            </optgroup>
                        </select>
                        <p class="text-xs text-gray-500 mt-1" id="optionDesc">* 3줄마다: 엔터를 싹 지우고 3줄마다 새로 띄웁니다.</p>
                    </div>
                </div>
                <textarea id="newLyrics" rows="10" class="mt-1 block w-full p-2 border rounded-md" placeholder="가사를 여기에 붙여넣으세요."></textarea>
            </div>
        </div>

        <div class="space-y-6">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold border-b pb-2 mb-4">2. 현재 data.js 내용 붙여넣기</h2>
                <textarea id="oldData" rows="6" class="w-full p-2 border rounded-md bg-gray-50" placeholder="현재 data.js 파일의 전체 내용을 여기에 붙여넣으세요."></textarea>
            </div>

            <button id="btnGenerate" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 rounded-lg text-lg shadow-lg transition transform hover:scale-[1.01]">
                ✨ 가사 정리 & 코드 합체하기!
            </button>

            <div class="bg-white p-6 rounded-lg shadow-md border-2 border-teal-100">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-xl font-semibold text-teal-900">3. 결과 (복사해서 덮어쓰세요)</h2>
                    <button id="btnCopy" class="text-sm bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded font-medium">📋 전체 복사</button>
                </div>
                <textarea id="resultData" rows="12" class="w-full p-2 border rounded-md bg-slate-800 text-green-400 focus:outline-none focus:ring-2 focus:ring-green-500" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            
            // 설명문구 자동 변경
            const selectEl = document.getElementById('lineOption');
            const descEl = document.getElementById('optionDesc');
            
            selectEl.addEventListener('change', () => {
                const val = parseInt(selectEl.value);
                if (val === 3) descEl.innerText = "* 3줄마다: 엔터를 싹 지우고 3줄마다 새로 띄웁니다. (일-발음-한 패턴)";
                else if (val === 4) descEl.innerText = "* 과한 엔터 정리: 원래 가사 모양은 유지하되, 너무 넓은 공백만 줄입니다. (혼합 가사 추천)";
                else if (val === 5) descEl.innerText = "* 모든 빈 줄 제거: 가사 사이의 공백을 모두 없애고 다닥다닥 붙입니다.";
                else descEl.innerText = "* 선택된 옵션에 따라 가사를 정리합니다.";
            });

            document.getElementById('btnGenerate').addEventListener('click', generateData);
            document.getElementById('btnCopy').addEventListener('click', copyResult);

            function generateData() {
                try {
                    const oldCode = document.getElementById('oldData').value;
                    const title = document.getElementById('newTitle').value.trim();
                    const artist = document.getElementById('newArtist').value.trim();
                    const link = document.getElementById('newLink').value.trim();
                    const source = document.getElementById('newSource').value.trim();
                    let lyricsInput = document.getElementById('newLyrics').value;
                    const lineOption = parseInt(document.getElementById('lineOption').value);

                    if (!oldCode.includes('playlistData')) {
                        alert("기존 data.js 코드가 올바르지 않은 것 같아요.\n'export const playlistData'가 포함되어 있는지 확인해주세요.");
                        return;
                    }
                    if (!title || !link) {
                        alert("최소한 '곡 제목'과 '유튜브 링크'는 입력해주세요!");
                        return;
                    }

                    // ID 자동 계산
                    const idMatches = oldCode.match(/id:\s*(\d+)/g);
                    let nextId = 1;
                    if (idMatches) {
                        const ids = idMatches.map(str => parseInt(str.replace(/id:\s*/, '')));
                        nextId = Math.max(...ids) + 1;
                    }

                    // =========================================================
                    // [핵심] 가사 정렬 로직 (옵션별 분기)
                    // =========================================================
                    let finalLyrics = lyricsInput;

                    if (lineOption >= 1 && lineOption <= 3) {
                        // 모드 1,2,3: 기존 구조 파괴 후 재조립 (패턴형 가사)
                        const cleanLines = lyricsInput.split('\n')
                                                    .map(line => line.trim())
                                                    .filter(line => line !== "");
                        let formatted = "";
                        for (let i = 0; i < cleanLines.length; i++) {
                            formatted += cleanLines[i] + "\n";
                            if ((i + 1) % lineOption === 0 && i !== cleanLines.length - 1) {
                                formatted += "\n";
                            }
                        }
                        finalLyrics = formatted.trim();

                    } else if (lineOption === 4) {
                        // [NEW] 모드 4: 과한 엔터만 정리 (구조 유지)
                        // 1. 각 줄의 앞뒤 공백 제거
                        finalLyrics = lyricsInput.split('\n').map(l => l.trim()).join('\n');
                        // 2. 3개 이상의 엔터(\n\n\n+)를 2개(\n\n)로 축소 -> 빈 줄 1개 유지
                        finalLyrics = finalLyrics.replace(/\n{3,}/g, '\n\n').trim();

                    } else if (lineOption === 5) {
                        // [NEW] 모드 5: 모든 빈 줄 제거
                        // 1. 각 줄 앞뒤 공백 제거
                        finalLyrics = lyricsInput.split('\n').map(l => l.trim()).join('\n');
                        // 2. 2개 이상의 엔터(\n\n+)를 1개(\n)로 축소 -> 빈 줄 삭제
                        finalLyrics = finalLyrics.replace(/\n{2,}/g, '\n').trim();
                    }
                    // 옵션 0이면 원본 그대로 사용

                    // 출처 추가
                    if (source) {
                        if (finalLyrics.length > 0) {
                            finalLyrics += `\n\n( 출처 : ${source} )`;
                        } else {
                            finalLyrics = `( 출처 : ${source} )`;
                        }
                    }

                    // 이스케이프 처리
                    finalLyrics = finalLyrics.replace(/`/g, "\\`");

                    // 코드 생성
                    const newSongStr = `
    {
        id: ${nextId},
        title: "${title}",
        artist: "${artist}",
        link: "${link}",
        lyrics: \`${finalLyrics}\`
    }`;

                    const lastBracketIndex = oldCode.lastIndexOf(']');
                    if (lastBracketIndex === -1) {
                        alert("기존 코드 형식이 이상합니다. (닫는 대괄호 ']' 없음)");
                        return;
                    }

                    const before = oldCode.substring(0, lastBracketIndex).trimEnd();
                    const comma = before.endsWith(',') ? '' : ',';
                    const after = oldCode.substring(lastBracketIndex);

                    const finalCode = before + comma + newSongStr + "\n" + after;
                    document.getElementById('resultData').value = finalCode;

                } catch (error) {
                    console.error(error);
                    alert("오류가 발생했습니다: " + error.message);
                }
            }

            function copyResult() {
                const copyText = document.getElementById("resultData");
                if (!copyText.value) return;
                copyText.select();
                copyText.setSelectionRange(0, 99999); 
                navigator.clipboard.writeText(copyText.value).then(() => {
                    alert("복사 완료! data.js 파일에 덮어쓰세요.");
                }).catch(err => {
                    alert("복사 실패. 직접 복사해주세요.");
                });
            }
        });
    </script>
</body>
</html>

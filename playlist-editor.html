<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í¸ì§‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="utils.js"></script>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-100">

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <nav class="bg-white border-b px-6 py-3 flex justify-between items-center z-10 shrink-0 shadow-sm">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-indigo-600 transition">
                <i data-lucide="arrow-left"></i>
            </a>
            <h1 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="list-music" class="text-green-600"></i> 
                í”Œë ˆì´ë¦¬ìŠ¤íŠ¸ í¸ì§‘ê¸°
            </h1>
        </div>
        <button onclick="exportData()" class="btn btn-success">
            <i data-lucide="save" class="w-4 h-4"></i> ì½”ë“œ ìƒì„±
        </button>
    </nav>

    <!-- ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° -->
    <div class="bg-white border-b p-4 shrink-0">
        <label class="form-label">ğŸ“‚ playlist.js ì½”ë“œ ë¶™ì—¬ë„£ê¸°</label>
        <div class="flex gap-2 relative">
            <textarea id="inputCode" rows="1" class="form-input flex-1 h-10 resize-none" 
                placeholder="export const playlistData = [...] í˜•ì‹ì˜ ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”"></textarea>
            <button onclick="loadData()" class="btn btn-secondary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <div id="inputBlocker" class="absolute inset-0 bg-gray-100/80 hidden flex items-center justify-center text-xs font-bold text-gray-500 cursor-not-allowed">
                ì´ë¯¸ ë¶ˆëŸ¬ì™”ìŠµë‹ˆë‹¤
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì˜ì—­ -->
    <div class="flex-1 overflow-hidden grid grid-cols-12">
        <!-- ì¢Œì¸¡: ê³¡ ëª©ë¡ -->
        <div class="col-span-3 bg-white border-r flex flex-col overflow-hidden">
            <div class="p-3 bg-slate-50 border-b flex justify-between items-center">
                <span class="font-bold text-sm text-slate-700">ê³¡ ëª©ë¡ (<span id="songCount">0</span>)</span>
                <button onclick="addItem()" class="text-xs bg-indigo-500 text-white px-2 py-1 rounded hover:bg-indigo-600">+ ì¶”ê°€</button>
            </div>
            <div id="itemList" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-50">
                <div class="text-center text-gray-400 text-xs mt-10">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <!-- ìš°ì¸¡: í¸ì§‘ í¼ -->
        <div class="col-span-9 bg-slate-50 flex flex-col overflow-y-auto p-6" id="rightPanel">
            <div id="editForm" class="max-w-3xl mx-auto w-full bg-white rounded-xl shadow p-6 hidden">
                <h2 class="text-lg font-bold border-b pb-2 mb-4 flex justify-between">
                    <span>ğŸ“ ìƒì„¸ ì •ë³´ ìˆ˜ì •</span>
                    <span id="currentId" class="text-xs bg-slate-200 px-2 py-1 rounded">ID: -</span>
                </h2>

                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="form-label">ê³¡ ì œëª©</label>
                            <input type="text" id="editTitle" class="form-input">
                        </div>
                        <div>
                            <label class="form-label">ì•„í‹°ìŠ¤íŠ¸</label>
                            <input type="text" id="editArtist" class="form-input">
                        </div>
                    </div>

                    <div>
                        <label class="form-label">YouTube ë§í¬</label>
                        <input type="text" id="editLink" class="form-input" placeholder="https://www.youtube.com/watch?v=...">
                    </div>

                    <div>
                        <label class="form-label">í•´ì‹œíƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
                        <input type="text" id="editTags" class="form-input" placeholder="#íƒœê·¸1, #íƒœê·¸2">
                    </div>

                    <div>
                        <label class="form-label">ì½”ë©˜íŠ¸</label>
                        <input type="text" id="editComment" class="form-input" placeholder="ì´ ê³¡ì— ëŒ€í•œ í•œì¤„í‰">
                    </div>

                    <div>
                        <label class="form-label flex justify-between">
                            <span>ê°€ì‚¬</span>
                            <select id="formatOption" class="text-xs border rounded px-2 py-1">
                                <option value="0">í¬ë§· ì—†ìŒ</option>
                                <option value="3">3ì¤„ë§ˆë‹¤ ë¹ˆ ì¤„</option>
                                <option value="4">ë¹ˆ ì¤„ ì •ë¦¬ (2ì¤„â†’1ì¤„)</option>
                                <option value="5">ëª¨ë“  ë¹ˆ ì¤„ ì œê±°</option>
                            </select>
                        </label>
                        <textarea id="editLyrics" class="form-input form-textarea h-40"></textarea>
                        <div class="flex gap-2 mt-2">
                            <input type="text" id="editSource" class="form-input flex-1" placeholder="ê°€ì‚¬ ì¶œì²˜ URL (ì„ íƒ)">
                            <button onclick="applyFormat()" class="btn btn-secondary text-xs">í¬ë§· ì ìš©</button>
                        </div>
                    </div>

                    <div class="pt-4 border-t flex justify-between">
                        <button onclick="deleteItem()" class="btn btn-danger text-sm">
                            <i data-lucide="trash-2" class="w-4 h-4"></i> ì‚­ì œ
                        </button>
                        <button onclick="saveItem()" class="btn btn-primary">
                            <i data-lucide="check" class="w-4 h-4"></i> ì ìš©
                        </button>
                    </div>
                </div>
            </div>

            <!-- ì½”ë“œ ì¶œë ¥ -->
            <div id="exportArea" class="hidden mt-6 code-output max-w-3xl mx-auto w-full">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-green-400 font-bold">âœ… ì½”ë“œ ìƒì„± ì™„ë£Œ</span>
                    <button onclick="copyCode()" class="btn btn-success text-sm">ğŸ“‹ ë³µì‚¬</button>
                </div>
                <textarea id="exportResult" rows="12" class="w-full" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        let items = [];
        let currentIndex = -1;

        function loadData() {
            const raw = document.getElementById('inputCode').value.trim();
            if (!raw) return alert('ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.');
            
            try {
                items = HelperUtils.parseExportData(raw, 'playlistData');
                renderList();
                document.getElementById('inputBlocker').classList.remove('hidden');
                document.getElementById('inputCode').disabled = true;
                HelperUtils.showToast(`${items.length}ê³¡ ë¡œë“œ ì™„ë£Œ!`, 'success');
            } catch (e) {
                alert('ë¡œë“œ ì‹¤íŒ¨: ' + e.message);
            }
        }

        function renderList() {
            const list = document.getElementById('itemList');
            document.getElementById('songCount').textContent = items.length;
            
            if (items.length === 0) {
                list.innerHTML = '<div class="text-center text-gray-400 text-xs mt-10">ê³¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            list.innerHTML = items.map((item, idx) => `
                <div class="list-item ${idx === currentIndex ? 'active' : ''}" onclick="openForm(${idx})">
                    <span class="truncate font-medium text-sm">${item.id}. ${item.title || '(ì œëª© ì—†ìŒ)'}</span>
                    <span class="text-xs text-slate-400">${item.artist || ''}</span>
                </div>
            `).join('');
        }

        function openForm(idx) {
            currentIndex = idx;
            const item = items[idx];
            
            document.getElementById('editForm').classList.remove('hidden');
            document.getElementById('currentId').textContent = `ID: ${item.id}`;
            document.getElementById('editTitle').value = item.title || '';
            document.getElementById('editArtist').value = item.artist || '';
            document.getElementById('editLink').value = item.link || '';
            document.getElementById('editTags').value = (item.hashtags || []).join(', ');
            document.getElementById('editComment').value = item.comment || '';
            
            // ê°€ì‚¬ì—ì„œ ì¶œì²˜ ë¶„ë¦¬
            let lyrics = item.lyrics || '';
            let source = '';
            const match = lyrics.trim().match(/\(\s*ì¶œì²˜\s*:\s*(https?:\/\/[^)\s]+)\s*\)$/i);
            if (match) {
                source = match[1];
                lyrics = lyrics.replace(match[0], '').trim();
            }
            document.getElementById('editLyrics').value = lyrics;
            document.getElementById('editSource').value = source;
            
            document.getElementById('exportArea').classList.add('hidden');
            renderList();
        }

        function addItem() {
            const newId = HelperUtils.getNextId(items);
            items.push({
                id: newId,
                title: 'ìƒˆ ë…¸ë˜',
                artist: '',
                link: '',
                hashtags: [],
                comment: '',
                lyrics: ''
            });
            renderList();
            openForm(items.length - 1);
        }

        function saveItem() {
            if (currentIndex === -1) return;
            
            const item = items[currentIndex];
            item.title = document.getElementById('editTitle').value;
            item.artist = document.getElementById('editArtist').value;
            item.link = document.getElementById('editLink').value;
            item.comment = document.getElementById('editComment').value;
            
            // í•´ì‹œíƒœê·¸ íŒŒì‹±
            const tagsRaw = document.getElementById('editTags').value;
            item.hashtags = tagsRaw.split(',')
                .map(t => t.trim())
                .filter(t => t)
                .map(t => t.startsWith('#') ? t : '#' + t);
            
            // ê°€ì‚¬ + ì¶œì²˜
            let lyrics = document.getElementById('editLyrics').value;
            const source = document.getElementById('editSource').value.trim();
            if (source) {
                lyrics = lyrics.trim() + `\n\n( ì¶œì²˜ : ${source} )`;
            }
            item.lyrics = lyrics;
            
            renderList();
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function deleteItem() {
            if (currentIndex === -1) return;
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            items.splice(currentIndex, 1);
            document.getElementById('editForm').classList.add('hidden');
            currentIndex = -1;
            renderList();
        }

        function applyFormat() {
            const option = parseInt(document.getElementById('formatOption').value);
            let text = document.getElementById('editLyrics').value;
            document.getElementById('editLyrics').value = HelperUtils.formatLyrics(text, option, '');
        }

        function exportData() {
            if (currentIndex !== -1) saveItem();
            
            const code = HelperUtils.generatePlaylistCode(items);
            document.getElementById('exportArea').classList.remove('hidden');
            document.getElementById('exportResult').value = code;
            document.getElementById('exportArea').scrollIntoView({ behavior: 'smooth' });
        }

        function copyCode() {
            const code = document.getElementById('exportResult').value;
            HelperUtils.copyToClipboard(code);
            HelperUtils.showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì„¤ì • í¸ì§‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="utils.js"></script>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-100">

    <nav class="bg-white border-b px-6 py-3 flex justify-between items-center z-10 shrink-0 shadow-sm">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-indigo-600"><i data-lucide="arrow-left"></i></a>
            <h1 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="sliders-horizontal" class="text-slate-600"></i> ì„¤ì • í¸ì§‘ê¸°
            </h1>
        </div>
        <button onclick="exportData()" class="btn btn-success">
            <i data-lucide="save" class="w-4 h-4"></i> ì½”ë“œ ìƒì„±
        </button>
    </nav>

    <div class="bg-white border-b p-4 shrink-0">
        <label class="form-label">ğŸ“‚ config.js ì½”ë“œ ë¶™ì—¬ë„£ê¸°</label>
        <div class="flex gap-2 relative">
            <textarea id="inputCode" rows="1" class="form-input flex-1 h-10 resize-none" 
                placeholder="export const config = {...}"></textarea>
            <button onclick="loadData()" class="btn btn-secondary">ë¶ˆëŸ¬ì˜¤ê¸°</button>
            <div id="inputBlocker" class="absolute inset-0 bg-gray-100/80 hidden flex items-center justify-center text-xs font-bold text-gray-500">ë¡œë“œë¨</div>
        </div>
    </div>

    <div class="flex-1 overflow-hidden grid grid-cols-12">
        <div class="col-span-3 bg-white border-r flex flex-col overflow-hidden">
            <div class="p-3 bg-slate-50 border-b font-bold text-sm text-slate-700">ì„¤ì • ì„¹ì…˜</div>
            <div id="sectionList" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-50">
                <div class="text-center text-gray-400 text-xs mt-10">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”</div>
            </div>
        </div>

        <div class="col-span-9 bg-slate-50 overflow-y-auto p-6">
            <!-- ë¼ë²¨ ì„¤ì • -->
            <div id="labelsForm" class="hidden max-w-3xl mx-auto card">
                <div class="card-header"><h2 class="font-bold">ğŸ·ï¸ í…ìŠ¤íŠ¸ ë¼ë²¨</h2></div>
                <div class="card-body">
                    <p class="text-sm text-slate-500 mb-4">í™”ë©´ì— í‘œì‹œë˜ëŠ” ê°ì¢… ë¼ë²¨ í…ìŠ¤íŠ¸ë¥¼ ìˆ˜ì •í•©ë‹ˆë‹¤.</p>
                    <div class="space-y-3" id="labelsContainer"></div>
                    <div class="pt-4 border-t flex justify-end mt-4">
                        <button onclick="saveLabels()" class="btn btn-primary">ì ìš©</button>
                    </div>
                </div>
            </div>

            <!-- í…Œë§ˆ ìƒ‰ìƒ -->
            <div id="themeForm" class="hidden max-w-3xl mx-auto card">
                <div class="card-header"><h2 class="font-bold">ğŸ¨ í…Œë§ˆ ìƒ‰ìƒ</h2></div>
                <div class="card-body">
                    <p class="text-sm text-slate-500 mb-4">ì‚¬ì´íŠ¸ ì „ì²´ ìƒ‰ìƒì„ ë³€ê²½í•©ë‹ˆë‹¤.</p>
                    <div class="grid grid-cols-2 gap-4" id="themeContainer"></div>
                    <div class="pt-4 border-t flex justify-end mt-4">
                        <button onclick="saveTheme()" class="btn btn-primary">ì ìš©</button>
                    </div>
                </div>
            </div>

            <!-- ê¸°ëŠ¥ ì„¤ì • -->
            <div id="featuresForm" class="hidden max-w-3xl mx-auto card">
                <div class="card-header"><h2 class="font-bold">âš™ï¸ ê¸°ëŠ¥ ON/OFF</h2></div>
                <div class="card-body">
                    <div class="space-y-3" id="featuresContainer"></div>
                    <div class="pt-4 border-t flex justify-end mt-4">
                        <button onclick="saveFeatures()" class="btn btn-primary">ì ìš©</button>
                    </div>
                </div>
            </div>

            <!-- ê¸°ë³¸ê°’ ì„¤ì • -->
            <div id="defaultsForm" class="hidden max-w-3xl mx-auto card">
                <div class="card-header"><h2 class="font-bold">ğŸ”§ ê¸°ë³¸ê°’</h2></div>
                <div class="card-body space-y-4">
                    <div>
                        <label class="form-label">ê¸°ë³¸ ë‚˜ì´ (ìºë¦­í„° íƒ­)</label>
                        <input type="number" id="defaults_age" class="form-input" placeholder="11">
                    </div>
                    <div>
                        <label class="form-label">ê¸°ë³¸ ì„¹ì…˜</label>
                        <select id="defaults_section" class="form-input">
                            <option value="dashboard">dashboard</option>
                            <option value="playlist">playlist</option>
                            <option value="motif">motif</option>
                            <option value="guide">guide</option>
                        </select>
                    </div>
                    <div class="pt-4 border-t flex justify-end">
                        <button onclick="saveDefaults()" class="btn btn-primary">ì ìš©</button>
                    </div>
                </div>
            </div>

            <!-- íƒ€ì´ë° ì„¤ì • -->
            <div id="timingForm" class="hidden max-w-3xl mx-auto card">
                <div class="card-header"><h2 class="font-bold">â±ï¸ íƒ€ì´ë° (ê³ ê¸‰)</h2></div>
                <div class="card-body">
                    <p class="text-sm text-slate-500 mb-4">ì• ë‹ˆë©”ì´ì…˜/ë”œë ˆì´ ì‹œê°„ (ms). ì˜ ëª¨ë¥´ë©´ ê¸°ë³¸ê°’ ìœ ì§€.</p>
                    <div class="grid grid-cols-2 gap-4" id="timingContainer"></div>
                    <div class="pt-4 border-t flex justify-end mt-4">
                        <button onclick="saveTiming()" class="btn btn-primary">ì ìš©</button>
                    </div>
                </div>
            </div>

            <!-- ì¶œë ¥ -->
            <div id="exportArea" class="hidden mt-6 code-output max-w-3xl mx-auto">
                <div class="flex justify-between items-center mb-3">
                    <span class="text-green-400 font-bold">âœ… ì½”ë“œ ìƒì„± ì™„ë£Œ</span>
                    <button onclick="copyCode()" class="btn btn-success text-sm">ğŸ“‹ ë³µì‚¬</button>
                </div>
                <textarea id="exportResult" rows="25" class="w-full" readonly></textarea>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        
        let data = null;
        let currentSection = null;

        const labelKeys = [
            { key: 'name', label: 'ì´ë¦„ ì„¹ì…˜ ì œëª©' },
            { key: 'basicInfo', label: 'ê¸°ë³¸ ì •ë³´ ì¹´ë“œ ì œëª©' },
            { key: 'birthInfo', label: 'íƒ„ìƒ ì •ë³´ ì¹´ë“œ ì œëª©' },
            { key: 'magicInfo', label: 'ë§ˆë²• ì •ë³´ ì¹´ë“œ ì œëª©' },
            { key: 'relationships', label: 'ê´€ê³„ ì„¹ì…˜ ì œëª©' },
            { key: 'heightWeight', label: 'í‚¤/ì²´ì¤‘ ë¼ë²¨' },
            { key: 'affiliation', label: 'ì†Œì† ë¼ë²¨' },
            { key: 'nationality', label: 'êµ­ì  ë¼ë²¨' },
            { key: 'blood', label: 'í˜ˆí†µ ë¼ë²¨' },
            { key: 'birthday', label: 'ìƒì¼ ë¼ë²¨' },
            { key: 'birthFlowerTree', label: 'íƒ„ìƒí™”/íƒ„ìƒëª© ë¼ë²¨' },
            { key: 'birthStone', label: 'íƒ„ìƒì„ ë¼ë²¨' },
            { key: 'birthColor', label: 'íƒ„ìƒìƒ‰ ë¼ë²¨' },
            { key: 'wand', label: 'ì§€íŒ¡ì´ ë¼ë²¨' },
            { key: 'wandLength', label: 'ì§€íŒ¡ì´ ê¸¸ì´ ë¼ë²¨' },
            { key: 'themeColor', label: 'í…Œë§ˆìƒ‰ ë¼ë²¨' },
            { key: 'moodSong', label: 'ë¬´ë“œê³¡ ë¼ë²¨' }
        ];

        const themeKeys = [
            { key: 'background', label: 'ë°°ê²½ìƒ‰' },
            { key: 'secondary', label: 'ë³´ì¡° ë°°ê²½' },
            { key: 'tertiary', label: '3ì°¨ ë°°ê²½' },
            { key: 'text', label: 'í…ìŠ¤íŠ¸' },
            { key: 'highlight', label: 'ê°•ì¡°ìƒ‰' },
            { key: 'border', label: 'í…Œë‘ë¦¬' }
        ];

        const featureKeys = [
            { key: 'showAgeTabs', label: 'ë‚˜ì´ íƒ­ í‘œì‹œ' },
            { key: 'snowEffect', label: 'ëˆˆ íš¨ê³¼' }
        ];

        const timingKeys = [
            { key: 'bgMusicInitDelay', label: 'ë°°ê²½ìŒì•… ì´ˆê¸°í™” ë”œë ˆì´' },
            { key: 'iconRenderDelay', label: 'ì•„ì´ì½˜ ë Œë” ë”œë ˆì´' },
            { key: 'videoLoadDelay', label: 'ë¹„ë””ì˜¤ ë¡œë“œ ë”œë ˆì´' },
            { key: 'bgMusicSwitchDelay', label: 'ë°°ê²½ìŒì•… ì „í™˜ ë”œë ˆì´' }
        ];

        function loadData() {
            const raw = document.getElementById('inputCode').value.trim();
            if (!raw) return alert('ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.');
            try {
                data = HelperUtils.parseExportData(raw, 'config');
                renderSections();
                document.getElementById('inputBlocker').classList.remove('hidden');
                HelperUtils.showToast('ë¡œë“œ ì™„ë£Œ!', 'success');
            } catch (e) { alert('ë¡œë“œ ì‹¤íŒ¨: ' + e.message); }
        }

        function renderSections() {
            document.getElementById('sectionList').innerHTML = `
                <div class="list-item ${currentSection === 'labels' ? 'active' : ''}" onclick="showLabels()">
                    <span class="font-medium text-sm">ğŸ·ï¸ í…ìŠ¤íŠ¸ ë¼ë²¨</span>
                </div>
                <div class="list-item ${currentSection === 'theme' ? 'active' : ''}" onclick="showTheme()">
                    <span class="font-medium text-sm">ğŸ¨ í…Œë§ˆ ìƒ‰ìƒ</span>
                </div>
                <div class="list-item ${currentSection === 'features' ? 'active' : ''}" onclick="showFeatures()">
                    <span class="font-medium text-sm">âš™ï¸ ê¸°ëŠ¥ ON/OFF</span>
                </div>
                <div class="list-item ${currentSection === 'defaults' ? 'active' : ''}" onclick="showDefaults()">
                    <span class="font-medium text-sm">ğŸ”§ ê¸°ë³¸ê°’</span>
                </div>
                <div class="list-item ${currentSection === 'timing' ? 'active' : ''}" onclick="showTiming()">
                    <span class="font-medium text-sm">â±ï¸ íƒ€ì´ë°</span>
                </div>
            `;
        }

        function hideAll() {
            ['labelsForm', 'themeForm', 'featuresForm', 'defaultsForm', 'timingForm', 'exportArea']
                .forEach(id => document.getElementById(id).classList.add('hidden'));
        }

        function showLabels() {
            hideAll();
            currentSection = 'labels';
            const container = document.getElementById('labelsContainer');
            container.innerHTML = labelKeys.map(({ key, label }) => `
                <div class="flex items-center gap-3">
                    <label class="w-40 text-sm text-slate-600">${label}</label>
                    <input type="text" class="form-input flex-1 label-input" data-key="${key}" 
                        value="${data.labels?.[key] || ''}">
                </div>
            `).join('');
            document.getElementById('labelsForm').classList.remove('hidden');
            renderSections();
        }

        function saveLabels() {
            if (!data.labels) data.labels = {};
            document.querySelectorAll('.label-input').forEach(input => {
                data.labels[input.dataset.key] = input.value;
            });
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function showTheme() {
            hideAll();
            currentSection = 'theme';
            const container = document.getElementById('themeContainer');
            container.innerHTML = themeKeys.map(({ key, label }) => {
                const value = data.theme?.colors?.[key] || '';
                const isColor = value.startsWith('#') || value.startsWith('rgb');
                return `
                    <div>
                        <label class="form-label">${label}</label>
                        <div class="flex gap-2">
                            ${isColor ? `<input type="color" class="w-10 h-10 rounded theme-picker" data-key="${key}" value="${value.startsWith('#') ? value : '#000000'}">` : ''}
                            <input type="text" class="form-input flex-1 theme-input" data-key="${key}" value="${value}">
                        </div>
                    </div>
                `;
            }).join('');
            
            // í”¼ì»¤ ë™ê¸°í™”
            container.querySelectorAll('.theme-picker').forEach(picker => {
                picker.addEventListener('input', e => {
                    const input = container.querySelector(`.theme-input[data-key="${e.target.dataset.key}"]`);
                    if (input) input.value = e.target.value;
                });
            });
            
            document.getElementById('themeForm').classList.remove('hidden');
            renderSections();
        }

        function saveTheme() {
            if (!data.theme) data.theme = {};
            if (!data.theme.colors) data.theme.colors = {};
            document.querySelectorAll('.theme-input').forEach(input => {
                data.theme.colors[input.dataset.key] = input.value;
            });
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function showFeatures() {
            hideAll();
            currentSection = 'features';
            const container = document.getElementById('featuresContainer');
            container.innerHTML = featureKeys.map(({ key, label }) => `
                <label class="flex items-center gap-3 cursor-pointer">
                    <input type="checkbox" class="w-5 h-5 feature-input" data-key="${key}" 
                        ${data.features?.[key] ? 'checked' : ''}>
                    <span class="text-sm">${label}</span>
                </label>
            `).join('');
            document.getElementById('featuresForm').classList.remove('hidden');
            renderSections();
        }

        function saveFeatures() {
            if (!data.features) data.features = {};
            document.querySelectorAll('.feature-input').forEach(input => {
                data.features[input.dataset.key] = input.checked;
            });
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function showDefaults() {
            hideAll();
            currentSection = 'defaults';
            document.getElementById('defaults_age').value = data.defaults?.age || 11;
            document.getElementById('defaults_section').value = data.defaults?.section || 'dashboard';
            document.getElementById('defaultsForm').classList.remove('hidden');
            renderSections();
        }

        function saveDefaults() {
            if (!data.defaults) data.defaults = {};
            data.defaults.age = parseInt(document.getElementById('defaults_age').value) || 11;
            data.defaults.section = document.getElementById('defaults_section').value;
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function showTiming() {
            hideAll();
            currentSection = 'timing';
            const container = document.getElementById('timingContainer');
            container.innerHTML = timingKeys.map(({ key, label }) => `
                <div>
                    <label class="form-label">${label}</label>
                    <input type="number" class="form-input timing-input" data-key="${key}" 
                        value="${data.timing?.[key] || 0}">
                </div>
            `).join('');
            document.getElementById('timingForm').classList.remove('hidden');
            renderSections();
        }

        function saveTiming() {
            if (!data.timing) data.timing = {};
            document.querySelectorAll('.timing-input').forEach(input => {
                data.timing[input.dataset.key] = parseInt(input.value) || 0;
            });
            HelperUtils.showToast('ì €ì¥ë¨', 'success');
        }

        function exportData() {
            // í˜„ì¬ ì„¹ì…˜ ì €ì¥
            if (currentSection === 'labels') saveLabels();
            if (currentSection === 'theme') saveTheme();
            if (currentSection === 'features') saveFeatures();
            if (currentSection === 'defaults') saveDefaults();
            if (currentSection === 'timing') saveTiming();

            const code = HelperUtils.generateConfigCode(data);
            document.getElementById('exportArea').classList.remove('hidden');
            document.getElementById('exportResult').value = code;
            document.getElementById('exportArea').scrollIntoView({ behavior: 'smooth' });
        }

        function copyCode() {
            HelperUtils.copyToClipboard(document.getElementById('exportResult').value);
            HelperUtils.showToast('ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í†µí•© í¸ì§‘ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
</head>
<body class="h-screen flex flex-col overflow-hidden bg-slate-100">

    <nav class="bg-white border-b px-6 py-3 flex justify-between items-center z-10 shrink-0 shadow-sm">
        <div class="flex items-center gap-4">
            <a href="index.html" class="text-slate-500 hover:text-indigo-600 transition">
                <i data-lucide="arrow-left"></i>
            </a>
            <h1 class="text-lg font-bold text-slate-800 flex items-center gap-2">
                <i data-lucide="list-music" class="text-green-600"></i> í†µí•© ë°ì´í„° í¸ì§‘ê¸°
            </h1>
        </div>
        <div class="flex gap-2">
            <button onclick="exportData()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm font-bold shadow flex items-center gap-2">
                <i data-lucide="save" size="16"></i> ì „ì²´ ì½”ë“œ ì €ì¥
            </button>
        </div>
    </nav>

    <div class="bg-white border-b p-4 shrink-0 shadow-sm z-10">
        <label class="block text-xs font-bold text-slate-500 mb-1">ğŸ“‚ data.js ì½”ë“œ ë¶ˆëŸ¬ì˜¤ê¸°</label>
        <div class="flex gap-2">
            <textarea id="editorInput" rows="1" class="flex-1 p-2 border rounded text-xs bg-slate-50 resize-none h-10 leading-tight" placeholder="export const playlistData = [...] ì½”ë“œë¥¼ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”."></textarea>
            <button onclick="loadData()" class="bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded text-sm font-bold shrink-0">
                ë¶ˆëŸ¬ì˜¤ê¸°
            </button>
        </div>
    </div>

    <div class="flex-1 overflow-hidden grid grid-cols-12">
        
        <div class="col-span-3 bg-white border-r flex flex-col overflow-hidden">
            <div class="p-3 bg-slate-50 border-b flex justify-between items-center">
                <span class="font-bold text-sm text-slate-700">ê³¡ ëª©ë¡ (<span id="songCount">0</span>)</span>
                <button onclick="addNewSong()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600">+ ì¶”ê°€</button>
            </div>
            <div id="songList" class="flex-1 overflow-y-auto p-2 space-y-1 bg-slate-100">
                <div class="text-center text-gray-400 text-xs mt-10">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™€ì£¼ì„¸ìš”.</div>
            </div>
        </div>

        <div class="col-span-9 bg-slate-50 flex flex-col overflow-y-auto p-6">
            <div id="editForm" class="max-w-3xl mx-auto w-full bg-white rounded shadow p-6 hidden">
                <h2 class="text-lg font-bold border-b pb-2 mb-4 flex justify-between">
                    <span>ğŸ“ ìƒì„¸ ì •ë³´ ìˆ˜ì •</span>
                    <span id="currentId" class="text-xs bg-slate-200 px-2 py-1 rounded text-slate-600">ID: -</span>
                </h2>

                <div class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500">ê³¡ ì œëª©</label>
                            <input type="text" id="editTitle" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500">ê°€ìˆ˜</label>
                            <input type="text" id="editArtist" class="w-full p-2 border rounded">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-xs font-bold text-slate-500">ìœ íŠœë¸Œ ë§í¬</label>
                        <input type="text" id="editLink" class="w-full p-2 border rounded">
                    </div>

                    <div class="bg-blue-50 p-3 rounded border border-blue-100">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-xs font-bold text-slate-700">ê°€ì‚¬ í¸ì§‘</label>
                            <div class="flex gap-2">
                                <select id="formatOption" class="text-xs border rounded p-1">
                                    <option value="3">3ì¤„ ë„ê¸°</option>
                                    <option value="4">ê³¼í•œ ì—”í„° ì •ë¦¬</option>
                                    <option value="5">ëª¨ë“  ë¹ˆ ì¤„ ì œê±°</option>
                                </select>
                                <button onclick="applyFormat()" class="text-xs bg-blue-500 text-white px-2 py-1 rounded">ì •ë¦¬ ì ìš©</button>
                            </div>
                        </div>
                        <textarea id="editLyrics" rows="10" class="w-full p-2 border rounded resize-none text-sm"></textarea>
                    </div>

                    <div class="bg-purple-50 p-3 rounded border border-purple-100">
                        <label class="block text-xs font-bold text-purple-700 mb-1">ì¶œì²˜ (ìë™ ë¶„ë¦¬ë¨)</label>
                        <div class="flex gap-2">
                            <input type="text" id="editSource" class="w-full p-2 border border-purple-200 rounded text-sm bg-white" placeholder="http://...">
                            <div class="text-xs text-purple-400 flex items-center shrink-0">
                                * ì €ì¥ ì‹œ ê°€ì‚¬ ë§¨ ëì— ìë™ìœ¼ë¡œ ë¶™ìŠµë‹ˆë‹¤.
                            </div>
                        </div>
                    </div>

                    <div class="pt-4 border-t flex justify-between">
                        <button onclick="deleteSong()" class="text-red-500 text-sm hover:underline">ğŸ—‘ï¸ ì‚­ì œ</button>
                        <button onclick="saveSong()" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded font-bold shadow transition transform hover:scale-105">
                            ì ìš© (ì„ì‹œ ì €ì¥)
                        </button>
                    </div>
                </div>
            </div>

            <div id="exportArea" class="hidden mt-6 bg-slate-800 p-4 rounded shadow-lg max-w-3xl mx-auto w-full">
                <div class="flex justify-between text-white mb-2 text-sm">
                    <span>âœ… ìƒì„±ëœ ì½”ë“œ</span>
                    <button onclick="copyExport()" class="text-green-400 hover:text-green-300">ë³µì‚¬í•˜ê¸°</button>
                </div>
                <textarea id="exportResult" rows="10" class="w-full p-2 bg-slate-900 text-green-400 font-mono text-xs rounded border border-slate-700"></textarea>
            </div>
        </div>
    </div>

    <script>
        lucide.createIcons();
        let loadedSongs = [];
        let currentIndex = -1;

        function loadData() {
            const raw = document.getElementById('editorInput').value.trim();
            if (!raw) return alert("ì½”ë“œë¥¼ ë¶™ì—¬ë„£ì–´ ì£¼ì„¸ìš”.");
            try {
                let cleanJson = raw.replace(/export\s+const\s+playlistData\s*=\s*/, '').trim();
                if(cleanJson.endsWith(';')) cleanJson = cleanJson.slice(0, -1);
                const func = new Function("return " + cleanJson);
                loadedSongs = func();
                renderList();
                alert(`${loadedSongs.length}ê³¡ ë¡œë“œ ì™„ë£Œ!`);
            } catch (e) { alert("ë¡œë“œ ì‹¤íŒ¨: " + e.message); }
        }

        function renderList() {
            const list = document.getElementById('songList');
            document.getElementById('songCount').innerText = loadedSongs.length;
            list.innerHTML = '';
            loadedSongs.forEach((song, idx) => {
                const div = document.createElement('div');
                div.className = "p-2 bg-white rounded border cursor-pointer hover:bg-indigo-50 transition text-sm mb-1 flex justify-between items-center";
                div.innerHTML = `<span class="truncate font-medium">${song.id}. ${song.title}</span>`;
                div.onclick = () => openForm(idx);
                list.appendChild(div);
            });
        }

        // [í•µì‹¬] ê°€ì‚¬ì™€ ì¶œì²˜ë¥¼ ë¶„ë¦¬í•´ì„œ í¼ì— ì±„ìš°ê¸°
        function openForm(idx) {
            currentIndex = idx;
            const s = loadedSongs[idx];
            document.getElementById('editForm').classList.remove('hidden');
            document.getElementById('currentId').innerText = `ID: ${s.id}`;
            
            document.getElementById('editTitle').value = s.title;
            document.getElementById('editArtist').value = s.artist || "";
            document.getElementById('editLink').value = s.link;

            // ê°€ì‚¬ íŒŒì‹± ë¡œì§
            let fullLyrics = s.lyrics || "";
            let sourceUrl = "";

            // ì •ê·œì‹: ë§ˆì§€ë§‰ ì¤„ì— ( ì¶œì²˜ : http... ) íŒ¨í„´ì´ ìˆëŠ”ì§€ ê²€ì‚¬
            // ë„ì–´ì“°ê¸°ê°€ ìˆë“  ì—†ë“  ìœ ì—°í•˜ê²Œ ì¡ë„ë¡ (?:\s*) ì‚¬ìš©
            const sourceRegex = /\(\s*ì¶œì²˜\s*:\s*(https?:\/\/[^)\s]+)\s*\)$/i;
            const match = fullLyrics.trim().match(sourceRegex);

            if (match) {
                sourceUrl = match[1]; // URL ë¶€ë¶„ë§Œ ì¶”ì¶œ
                // ê°€ì‚¬ì—ì„œ ì¶œì²˜ ë¶€ë¶„ ì œê±° (ì•ì˜ ì¤„ë°”ê¿ˆë„ ì œê±°)
                fullLyrics = fullLyrics.replace(match[0], "").trim();
            }

            document.getElementById('editLyrics').value = fullLyrics;
            document.getElementById('editSource').value = sourceUrl;
        }

        function addNewSong() {
            let maxId = loadedSongs.length > 0 ? Math.max(...loadedSongs.map(s => s.id)) : 0;
            loadedSongs.push({ id: maxId + 1, title: "ìƒˆ ë…¸ë˜", artist: "", link: "", lyrics: "" });
            renderList();
            openForm(loadedSongs.length - 1);
        }

        function applyFormat() {
            const opt = parseInt(document.getElementById('formatOption').value);
            let txt = document.getElementById('editLyrics').value;
            // ì¶œì²˜ëŠ” ì´ë¯¸ ë¶„ë¦¬ë˜ì–´ ìˆìœ¼ë¯€ë¡œ ìˆœìˆ˜ ê°€ì‚¬ë§Œ ì •ë ¬ë¨
            if (opt === 3) {
                const lines = txt.split('\n').map(l => l.trim()).filter(l => l !== "");
                let fmt = "";
                for(let i=0; i<lines.length; i++) {
                    fmt += lines[i] + "\n";
                    if ((i+1) % 3 === 0 && i !== lines.length-1) fmt += "\n";
                }
                txt = fmt.trim();
            } else if (opt === 4) {
                txt = txt.split('\n').map(l => l.trim()).join('\n').replace(/\n{3,}/g, '\n\n').trim();
            } else if (opt === 5) {
                txt = txt.split('\n').map(l => l.trim()).join('\n').replace(/\n{2,}/g, '\n').trim();
            }
            document.getElementById('editLyrics').value = txt;
        }

        // [í•µì‹¬] ì €ì¥í•  ë•Œ ê°€ì‚¬ì™€ ì¶œì²˜ ë‹¤ì‹œ í•©ì¹˜ê¸°
        function saveSong() {
            if(currentIndex === -1) return;
            const s = loadedSongs[currentIndex];
            
            s.title = document.getElementById('editTitle').value;
            s.artist = document.getElementById('editArtist').value;
            s.link = document.getElementById('editLink').value;
            
            let lyricsBody = document.getElementById('editLyrics').value.trim();
            const sourceUrl = document.getElementById('editSource').value.trim();

            if(sourceUrl) {
                // ê°€ì‚¬ê°€ ìˆìœ¼ë©´ ë‘ ì¤„ ë„ê³ , ì—†ìœ¼ë©´ ê·¸ëƒ¥ ì¶”ê°€
                if(lyricsBody) lyricsBody += `\n\n( ì¶œì²˜ : ${sourceUrl} )`;
                else lyricsBody = `( ì¶œì²˜ : ${sourceUrl} )`;
            }
            s.lyrics = lyricsBody;

            renderList();
            alert("ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ê¼­ 'ì „ì²´ ì½”ë“œ ì €ì¥'ì„ í•´ì£¼ì„¸ìš”.");
        }

        function deleteSong() {
            if(confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                loadedSongs.splice(currentIndex, 1);
                document.getElementById('editForm').classList.add('hidden');
                renderList();
                currentIndex = -1;
            }
        }

        function exportData() {
            const json = loadedSongs.map(s => {
                const safeLyrics = (s.lyrics || "").replace(/`/g, "\\`");
                return `    { id: ${s.id}, title: "${s.title}", artist: "${s.artist}", link: "${s.link}", lyrics: \`${safeLyrics}\` }`;
            }).join(',\n');
            const code = `export const playlistData = [\n${json}\n];`;
            const area = document.getElementById('exportArea');
            area.classList.remove('hidden');
            document.getElementById('exportResult').value = code;
            area.scrollIntoView({behavior: "smooth"});
        }

        function copyExport() {
            const el = document.getElementById('exportResult');
            el.select();
            document.execCommand('copy');
            alert("ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
        }
    </script>
</body>
</html>
